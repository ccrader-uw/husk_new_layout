#:import Clock kivy.clock.Clock
#:import threading threading
#:import partial functools.partial
<Touchpanel>:
    canvas:
        Color:
            rgba: 1, 1, 1, 1
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'images/background.png' 
    # Controls
    BoxLayout:
        cols: 3
        orientation: 'horizontal'
        pos: 20, 50
        rows: 5
        size: 560, 400
        size_hint: None, None
        spacing: 20
        BoxLayout:
            spacing: 20
            orientation: 'vertical'
            Button:
                background_normal: 'images/labels/display-label.png'
                background_down: 'images/labels/display-label.png'
                id: display_label
                #size: 172, 66
                #size_hint: None, None
            PowerOnButton:
                background_normal: 'images/buttons/off/projectoron.png'
                background_down: 'images/buttons/on/projectoron.png'
                id: power
                group: 'power_buttons'
                on_state: self.start_projector() if (self.state == 'down') else print()
                state: 'down' if app.projector.power_state == True else 'normal'
            PowerOffButton:
                background_normal: 'images/buttons/off/projectoroff.png'
                background_down: 'images/buttons/on/projectoroff.png'
                id: power_off
                group: 'power_buttons'
                on_state: self.stop_projector() if (self.state == 'down') else print()
                state: 'down' if app.projector.power_state == False else 'normal'
            ToggleButton:
                background_normal: 'images/buttons/off/blank.png'
                background_down: 'images/buttons/on/blank.png'
                id: blank 
                on_state: app.controller.turn_on_blank() if (self.state == 'down') else app.controller.turn_off_blank()
                state: 'down' if app.image.blanked else 'normal'
            ToggleButton:
                background_normal: 'images/buttons/off/freeze.png'
                background_down: 'images/buttons/on/freeze.png'
                id: freeze
                on_state: app.controller.turn_on_freeze() if (self.state == 'down') else app.controller.turn_off_freeze()
                state: 'down' if app.image.frozen else 'normal'
        # Input
        BoxLayout:
            orientation: 'vertical'
            spacing: 20
            Button:
                background_normal: 'images/labels/input-label.png'
                background_down: 'images/labels/input-label.png'
                id: input_label
            ToggleButton:
                background_normal: 'images/buttons/off/podium.png'
                background_down: 'images/buttons/on/podium.png'
                id: podium
                group: 'input_buttons'
                on_state: app.input.set_podium() if (self.state == 'down') else print()
                state: 'down' if app.input.input == 0 else 'normal'
            ToggleButton:
                background_normal: 'images/buttons/off/usbc.png'
                background_down: 'images/buttons/on/usbc.png'
                id: usbc
                group: 'input_buttons'
                state: 'down' if app.input.input == 2 else 'normal'
                on_state: app.input.set_usbc() if (self.state == 'down') else print()
            ToggleButton:
                background_normal: 'images/buttons/off/hdmi.png'
                background_down: 'images/buttons/on/hdmi.png'
                id: hdmi
                group: 'input_buttons'
                state: 'down' if app.input.input == 1 else 'normal'
                on_state: app.input.set_hdmi() if (self.state == 'down') else print()
            ToggleButton:
                background_normal: 'images/buttons/off/vga.png'
                background_down: 'images/buttons/on/vga.png'
                id: vga
                group: 'input_buttons'
                state: 'down' if app.input.input == 3 else 'normal'
                on_state: app.input.set_vga() if (self.state == 'down') else print()
        # Audio
        BoxLayout:
            orientation: 'vertical'
            spacing: 20
            Button:
                background_normal: 'images/labels/audio-label.png'
                background_down: 'images/labels/audio-label.png'
                size_hint: 1, 0.17
            Slider:
                cursor_height: 21
                cursor_image: 'images/slider/cursor.png'
                cursor_width: 21
                id: volume
                min: 0
                max: 100
                on_value: app.sound.set_volume(int(self.value))
                orientation: 'vertical'
                size_hint: 1, 0.66
                step: 1
                value: app.sound.volume
                value_track: True
                value_track_color: [0, 0, 0, 1]
            ToggleButton:
                background_normal: 'images/buttons/off/mute.png'
                background_down: 'images/buttons/on/unmute.png'
                id: mute
                on_state: app.sound.set_mute() if (self.state == 'down') else app.sound.unset_mute()
                size_hint: 1, 0.17
                state: 'down' if app.sound.mute else 'normal'
            #size_hint: None, None
